{"ast":null,"code":"import axios from \"axios\";\nimport { api_endpoint } from \"../settings\";\nconst axiosWithToken = axios.create({\n  // baseURL: \"http://\" + window.location.hostname + \":\" + api_port,\n  baseURL: api_endpoint,\n  timeout: 1000\n});\naxiosWithToken.interceptors.request.use(config => {\n  if (config.method === \"get\") {\n    config.params = {\n      token: sessionStorage.getItem(\"token\"),\n      key: sessionStorage.getItem(\"key\"),\n      user_id: sessionStorage.getItem(\"user_id\"),\n      ...config.params\n    };\n  }\n\n  if (config.method === \"post\") {\n    config.data = {\n      token: sessionStorage.getItem(\"token\"),\n      key: sessionStorage.getItem(\"key\"),\n      user_id: sessionStorage.getItem(\"user_id\"),\n      ...config.data\n    };\n  }\n\n  return config;\n});\naxiosWithToken.interceptors.response.use(response => {\n  if (response.data && response.data.response && response.data.status === \"OK\") {\n    sessionStorage.setItem(\"key\", response.data.response.key);\n    sessionStorage.setItem(\"token\", response.data.response.token);\n  } else if (response.data.status === \"FAIL\") {\n    response.data.key && sessionStorage.setItem(\"key\", response.data.key);\n    response.data.token && sessionStorage.setItem(\"token\", response.data.token);\n  }\n\n  if (response.data && +response.data.code === 17) {\n    window.location.replace(window.location.origin + '/login');\n  }\n\n  return response;\n});\n\nclass Queue {\n  static enqueue(promise) {\n    return new Promise((resolve, reject) => {\n      this.queue.push({\n        promise,\n        resolve,\n        reject\n      });\n      this.dequeue();\n    });\n  }\n\n  static dequeue() {\n    if (this.workingOnPromise) {\n      return false;\n    }\n\n    if (this.stop) {\n      this.queue = [];\n      this.stop = false;\n      return;\n    }\n\n    const item = this.queue.shift();\n\n    if (!item) {\n      return false;\n    }\n\n    try {\n      this.workingOnPromise = true;\n      item.promise().then(value => {\n        this.workingOnPromise = false;\n        item.resolve(value);\n        this.dequeue();\n      }).catch(err => {\n        this.workingOnPromise = false;\n        item.reject(err);\n        this.dequeue();\n      });\n    } catch (err) {\n      this.workingOnPromise = false;\n      item.reject(err);\n      this.dequeue();\n    }\n\n    return true;\n  }\n\n  static get() {\n    return this.enqueue(() => axiosWithToken.get(...arguments));\n  }\n\n  static post() {\n    return this.enqueue(() => axiosWithToken.post(...arguments));\n  }\n\n}\n\nQueue.queue = [];\nQueue.pendingPromise = false;\nQueue.stop = false;\nexport default Queue;","map":{"version":3,"sources":["C:/Users/Dno/Desktop/pu-web/src/utils/axiosWithToken.js"],"names":["axios","api_endpoint","axiosWithToken","create","baseURL","timeout","interceptors","request","use","config","method","params","token","sessionStorage","getItem","key","user_id","data","response","status","setItem","code","window","location","replace","origin","Queue","enqueue","promise","Promise","resolve","reject","queue","push","dequeue","workingOnPromise","stop","item","shift","then","value","catch","err","get","arguments","post","pendingPromise"],"mappings":"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","sourcesContent":["import axios from \"axios\";\r\nimport { api_endpoint } from \"../settings\";\r\n\r\n\r\nconst axiosWithToken = axios.create({\r\n  // baseURL: \"http://\" + window.location.hostname + \":\" + api_port,\r\n  baseURL: api_endpoint,\r\n  timeout: 1000,\r\n});\r\n\r\naxiosWithToken.interceptors.request.use( (config) => {\r\n  if (config.method === \"get\") {\r\n    config.params = {\r\n      token: sessionStorage.getItem(\"token\"),\r\n      key: sessionStorage.getItem(\"key\"),\r\n      user_id: sessionStorage.getItem(\"user_id\"),\r\n      ...config.params,\r\n    };\r\n  }\r\n  if (config.method === \"post\") {\r\n    config.data = {\r\n      token: sessionStorage.getItem(\"token\"),\r\n      key: sessionStorage.getItem(\"key\"),\r\n      user_id: sessionStorage.getItem(\"user_id\"),\r\n      ...config.data,\r\n    };\r\n  }\r\n\r\n  return  config;\r\n});\r\n\r\naxiosWithToken.interceptors.response.use((response) => {\r\n\r\n  if (\r\n    response.data &&\r\n    response.data.response &&\r\n    response.data.status === \"OK\"\r\n  ) {\r\n    sessionStorage.setItem(\"key\", response.data.response.key);\r\n    sessionStorage.setItem(\"token\", response.data.response.token);\r\n  } else if (response.data.status === \"FAIL\") {\r\n    response.data.key && sessionStorage.setItem(\"key\", response.data.key);\r\n    response.data.token && sessionStorage.setItem(\"token\", response.data.token);\r\n  }\r\n\r\n  if(response.data && +response.data.code === 17) {\r\n    window.location.replace(window.location.origin+'/login');\r\n  }\r\n\r\n  return response;\r\n});\r\n\r\n\r\n\r\nclass Queue {\r\n  static enqueue(promise) {\r\n      return new Promise((resolve, reject) => {\r\n          this.queue.push({\r\n              promise,\r\n              resolve,\r\n              reject\r\n          });\r\n          this.dequeue();\r\n      });\r\n  }\r\n\r\n  static dequeue() {\r\n      if (this.workingOnPromise) {\r\n          return false;\r\n      }\r\n      if (this.stop) {\r\n          this.queue = [];\r\n          this.stop = false;\r\n          return;\r\n      }\r\n      const item = this.queue.shift();\r\n      if (!item) {\r\n          return false;\r\n      }\r\n      try {\r\n          this.workingOnPromise = true;\r\n          item.promise()\r\n              .then(value => {\r\n                  this.workingOnPromise = false;\r\n                  item.resolve(value);\r\n                  this.dequeue();\r\n              })\r\n              .catch(err => {\r\n                  this.workingOnPromise = false;\r\n                  item.reject(err);\r\n                  this.dequeue();\r\n              });\r\n      } catch (err) {\r\n          this.workingOnPromise = false;\r\n          item.reject(err);\r\n          this.dequeue();\r\n      }\r\n      return true;\r\n  }\r\n\r\n  static get() {\r\n    return this.enqueue(() => axiosWithToken.get(...arguments));\r\n  }\r\n\r\n  static post() {\r\n    return this.enqueue(() => axiosWithToken.post(...arguments));\r\n  }\r\n\r\n}\r\n\r\nQueue.queue = [];\r\nQueue.pendingPromise = false;\r\nQueue.stop = false;\r\n\r\n\r\nexport default Queue;\r\n\r\n"]},"metadata":{},"sourceType":"module"}