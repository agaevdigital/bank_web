{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _defineProperty from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import PageLayout from\"../layout/PageLayout\";import PUCustomInput from\"components/common/PUCustomInput\";import{Typography,makeStyles,Box,withStyles}from\"@material-ui/core\";import NumberFormat from\"react-number-format\";import PUPrimaryButton from\"components/common/PUPrimaryButton\";import{Link}from\"react-router-dom\";import axios from\"axios/index\";import{api_endpoint}from\"settings\";import ResendSmsCodeButton from\"../../buttons/ResendSmsCodeButton\";import Radium from\"radium\";var styles={wrap:{width:\"100%\",maxWidth:330},pageTitle:{fontSize:\"2rem\",textAlign:\"center\",marginBottom:15},ml20:{marginLeft:20},btnSend:{display:\"block\",margin:\"auto\"},btn:{height:30,padding:\"0 20px\"}};function getMaskAtIndex(index){var mask=\" \";if(typeof mask===\"string\"){return mask;}return mask[index]||\" \";}function formatWithPattern(numStr){var format=\"+# (###) ###-##-##\";var hashCount=0;var formattedNumberAry=format.split(\"\");for(var i=0,ln=format.length;i<ln;i++){if(format[i]===\"#\"){formattedNumberAry[i]=numStr[hashCount]||getMaskAtIndex(hashCount);hashCount+=1;}}return formattedNumberAry.join(\"\");}var RestorePassword=/*#__PURE__*/function(_Component){_inherits(RestorePassword,_Component);function RestorePassword(){var _getPrototypeOf2;var _this;_classCallCheck(this,RestorePassword);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(RestorePassword)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={num:\"\",confirmCode:null,code_id:null,user_id:null,createNewPass:false,phone_number_error:null,restore_password_code_error:null,new_password_error:null,new_password:'',repeated_password:'',counter:0};_this.setNum=function(val){_this.setState({num:val});};_this.inputFieldChange=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.startCounter=function(){var newCounter=_this.state.counter-1;if(newCounter>=0){setTimeout(function(){_this.setState({counter:newCounter});_this.startCounter();},1000);}};_this.sendRestoreSmsCode=function(){var phone_number=_this.state.num.replace(/[^+0-9]/gim,\"\");_this.setState({phone_number_error:null});axios.post(\"\".concat(api_endpoint,\"/restore_password_send_sms_code\"),{phone_number:phone_number}).then(function(res){if(res.data.status===\"OK\"){_this.setState(_objectSpread({},res.data.response));_this.setState({counter:60});setTimeout(function(){_this.startCounter();},100);}else{_this.setState({phone_number_error:res.data.errors[0].message});}});};_this.restoreSmsCodeCheck=function(){var postData={user_id:_this.state.user_id,code_id:_this.state.code_id,code:_this.state.confirmCode};_this.setState({restore_password_code_error:null});axios.post(\"\".concat(api_endpoint,\"/restore_password_code_check\"),postData).then(function(res){if(res.data.status===\"OK\"){_this.setState({createNewPass:true});}else{_this.setState({restore_password_code_error:res.data.errors[0].message});}});};_this.validatePass=function(pass){var digit=/\\d+/;// oneOrMoreDigit\nvar uCL=/[a-z]+/;// oneOrMoreUpperCaseLetter\nvar lCL=/[A-Z]+/;// oneOrMoreLowerCaseLetter\nvar mLength=8;return pass.length>=8&&digit.test(pass)&&uCL.test(pass)&&lCL.test(pass);};_this.saveNewPass=function(){var postData={user_id:+_this.state.user_id,code_id:+_this.state.code_id,code:+_this.state.confirmCode,new_password:_this.state.new_password,repeated_password:_this.state.repeated_password};if(_this.state.new_password!==_this.state.repeated_password){_this.setState({new_password_error:\"Passwords do not match\"});return;}if(!_this.validatePass(_this.state.new_password)){_this.setState({new_password_error:\"Password must contain at least 8 symbols, at least one letter in upper case, at least one letter in lower case and at least one digit\"});return;}axios.post(\"\".concat(api_endpoint,\"/restore_password\"),postData).then(function(res){if(res.data.status===\"OK\"){_this.props.history&&_this.props.history.push(\"/login\");}});};return _this;}_createClass(RestorePassword,[{key:\"render\",value:function render(){var classes=this.props.classes;var _this$state=this.state,user_id=_this$state.user_id,code_id=_this$state.code_id;return React.createElement(PageLayout,null,React.createElement(\"div\",{className:classes.wrap},this.state.createNewPass&&React.createElement(React.Fragment,null,React.createElement(Typography,{className:classes.pageTitle},\"Create new password\"),React.createElement(Typography,{className:classes.ml20},\"New password\"),React.createElement(PUCustomInput,{onChange:this.inputFieldChange,value:this.state.new_password,name:\"new_password\",type:\"password\"}),this.state.new_password_error&&React.createElement(Typography,{color:\"error\"},this.state.new_password_error),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(Typography,{className:classes.ml20},\"Repeat password\"),React.createElement(PUCustomInput,{onChange:this.inputFieldChange,value:this.state.repeated_password,name:\"repeated_password\",type:\"password\"}),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(PUPrimaryButton,{onClick:this.saveNewPass,className:\"\".concat(classes.btnSend,\" \").concat(classes.btn)},\"Confirm\")),!this.state.createNewPass&&React.createElement(React.Fragment,null,React.createElement(Typography,{className:classes.pageTitle},\"Reset password\"),React.createElement(Typography,{className:classes.ml20},\"Please, input your phone number\"),React.createElement(NumberFormat,{onChange:this.inputFieldChange,value:this.state.num,name:\"num\",format:formatWithPattern,customInput:PUCustomInput}),this.state.phone_number_error&&React.createElement(Typography,{color:\"error\"},this.state.phone_number_error),React.createElement(\"br\",null),React.createElement(\"br\",null),this.state.counter===0?React.createElement(PUPrimaryButton,{onClick:this.sendRestoreSmsCode,className:\"\".concat(classes.btnSend,\" \").concat(classes.btn)},\"Send confirmation code\"):'You can resend new code via '+this.state.counter,React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(Typography,{className:\"\".concat(classes.ml20)},\"Input confirmation code from SMS\"),React.createElement(NumberFormat,{onChange:this.inputFieldChange,name:\"confirmCode\",value:this.state.confirmCode,customInput:PUCustomInput}),this.state.restore_password_code_error&&React.createElement(Typography,{color:\"error\"},this.state.restore_password_code_error),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(Box,{display:\"flex\",justifyContent:\"space-between\"},React.createElement(PUPrimaryButton,{component:Link,to:\"/login\",className:classes.btn},\"Cancel\"),React.createElement(PUPrimaryButton,{onClick:this.restoreSmsCodeCheck,className:classes.btn},\"Reset password\")))));}}]);return RestorePassword;}(Component);export default withStyles(styles)(Radium(RestorePassword));","map":{"version":3,"sources":["C:/Users/Dno/Desktop/pu-web/src/components/pages/login/RestorePassword.js"],"names":["React","Component","PageLayout","PUCustomInput","Typography","makeStyles","Box","withStyles","NumberFormat","PUPrimaryButton","Link","axios","api_endpoint","ResendSmsCodeButton","Radium","styles","wrap","width","maxWidth","pageTitle","fontSize","textAlign","marginBottom","ml20","marginLeft","btnSend","display","margin","btn","height","padding","getMaskAtIndex","index","mask","formatWithPattern","numStr","format","hashCount","formattedNumberAry","split","i","ln","length","join","RestorePassword","state","num","confirmCode","code_id","user_id","createNewPass","phone_number_error","restore_password_code_error","new_password_error","new_password","repeated_password","counter","setNum","val","setState","inputFieldChange","e","target","name","value","startCounter","newCounter","setTimeout","sendRestoreSmsCode","phone_number","replace","post","then","res","data","status","response","errors","message","restoreSmsCodeCheck","postData","code","validatePass","pass","digit","uCL","lCL","mLength","test","saveNewPass","props","history","push","classes"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PageLayout from \"../layout/PageLayout\";\nimport PUCustomInput from \"components/common/PUCustomInput\";\nimport { Typography, makeStyles, Box, withStyles } from \"@material-ui/core\";\nimport NumberFormat from \"react-number-format\";\nimport PUPrimaryButton from \"components/common/PUPrimaryButton\";\nimport { Link } from \"react-router-dom\";\nimport axios from \"axios/index\";\nimport { api_endpoint } from \"settings\";\nimport ResendSmsCodeButton from \"../../buttons/ResendSmsCodeButton\";\nimport Radium from \"radium\";\n\nconst styles = {\n  wrap: {\n    width: \"100%\",\n    maxWidth: 330,\n  },\n  pageTitle: {\n    fontSize: \"2rem\",\n    textAlign: \"center\",\n    marginBottom: 15,\n  },\n  ml20: {\n    marginLeft: 20,\n  },\n  btnSend: {\n    display: \"block\",\n    margin: \"auto\",\n  },\n  btn: {\n    height: 30,\n    padding: \"0 20px\",\n  },\n};\n\nfunction getMaskAtIndex(index) {\n  const mask = \" \";\n  if (typeof mask === \"string\") {\n    return mask;\n  }\n\n  return mask[index] || \" \";\n}\n\nfunction formatWithPattern(numStr) {\n  const format = \"+# (###) ###-##-##\";\n  let hashCount = 0;\n  const formattedNumberAry = format.split(\"\");\n  for (let i = 0, ln = format.length; i < ln; i++) {\n    if (format[i] === \"#\") {\n      formattedNumberAry[i] = numStr[hashCount] || getMaskAtIndex(hashCount);\n      hashCount += 1;\n    }\n  }\n  return formattedNumberAry.join(\"\");\n}\n\nclass RestorePassword extends Component {\n  state = {\n    num: \"\",\n    confirmCode: null,\n    code_id: null,\n    user_id: null,\n    createNewPass: false,\n    phone_number_error: null,\n    restore_password_code_error: null,\n    new_password_error: null,\n    new_password: '',\n    repeated_password: '',\n    counter: 0,\n  };\n  setNum = (val) => {\n    this.setState({ num: val });\n  };\n  inputFieldChange = (e) => {\n    this.setState({ [e.target.name]: e.target.value });\n  };\n  startCounter = () => {\n    let newCounter = this.state.counter-1;\n\n    if(newCounter >= 0) {\n      setTimeout(()=>{\n        this.setState({\n          counter: newCounter,\n        });\n        this.startCounter()\n      }, 1000)\n    }\n\n  }\n\n  sendRestoreSmsCode = () => {\n    let phone_number = this.state.num.replace(/[^+0-9]/gim, \"\");\n    this.setState({\n      phone_number_error: null,\n    });\n    axios\n      .post(`${api_endpoint}/restore_password_send_sms_code`, { phone_number })\n      .then((res) => {\n        if (res.data.status === \"OK\") {\n          this.setState({ ...res.data.response });\n          this.setState({\n            counter: 60,\n          });\n          setTimeout(()=>{\n            this.startCounter()\n          }, 100)\n\n        } else {\n          this.setState({\n            phone_number_error: res.data.errors[0].message,\n          });\n        }\n      });\n  };\n  restoreSmsCodeCheck = () => {\n    let postData = {\n      user_id: this.state.user_id,\n      code_id: this.state.code_id,\n      code: this.state.confirmCode,\n    };\n    this.setState({\n      restore_password_code_error: null,\n    });\n    axios\n      .post(`${api_endpoint}/restore_password_code_check`, postData)\n      .then((res) => {\n        if (res.data.status === \"OK\") {\n          this.setState({ createNewPass: true });\n        } else {\n          this.setState({\n            restore_password_code_error: res.data.errors[0].message,\n          });\n        }\n      });\n  };\n\n  validatePass = (pass) => {\n    const digit = /\\d+/; // oneOrMoreDigit\n    const uCL = /[a-z]+/; // oneOrMoreUpperCaseLetter\n    const lCL = /[A-Z]+/; // oneOrMoreLowerCaseLetter\n    const mLength = 8;\n\n    return (\n      pass.length >= 8 && digit.test(pass) && uCL.test(pass) && lCL.test(pass)\n    );\n  };\n\n  saveNewPass = () => {\n    let postData = {\n      user_id: +this.state.user_id,\n      code_id: +this.state.code_id,\n      code: +this.state.confirmCode,\n      new_password: this.state.new_password,\n      repeated_password: this.state.repeated_password,\n    };\n\n    if (this.state.new_password !== this.state.repeated_password) {\n      this.setState({ new_password_error: \"Passwords do not match\" });\n      return;\n    }\n\n    if (!this.validatePass(this.state.new_password)) {\n      this.setState({\n        new_password_error:\n          \"Password must contain at least 8 symbols, at least one letter in upper case, at least one letter in lower case and at least one digit\",\n      });\n      return;\n    }\n\n    axios.post(`${api_endpoint}/restore_password`, postData).then((res) => {\n      if (res.data.status === \"OK\") {\n        this.props.history && this.props.history.push(\"/login\");\n      }\n    });\n  };\n\n  render() {\n    const { classes } = this.props;\n    const { user_id, code_id } = this.state;\n\n    return (\n      <PageLayout>\n        <div className={classes.wrap}>\n          {this.state.createNewPass && (\n            <>\n              <Typography className={classes.pageTitle}>\n                Create new password\n              </Typography>\n              <Typography className={classes.ml20}>New password</Typography>\n              <PUCustomInput\n                onChange={this.inputFieldChange}\n                value={this.state.new_password}\n                name=\"new_password\"\n                type=\"password\"\n              />\n\n              {this.state.new_password_error && (\n                <Typography color=\"error\">\n                  {this.state.new_password_error}\n                </Typography>\n              )}\n              <br />\n              <br />\n              <Typography className={classes.ml20}>Repeat password</Typography>\n              <PUCustomInput\n                onChange={this.inputFieldChange}\n                value={this.state.repeated_password}\n                name=\"repeated_password\"\n                type=\"password\"\n              />\n              <br />\n              <br />\n              <PUPrimaryButton\n                onClick={this.saveNewPass}\n                className={`${classes.btnSend} ${classes.btn}`}\n              >\n                Confirm\n              </PUPrimaryButton>\n            </>\n          )}\n\n          {!this.state.createNewPass && (\n            <>\n              <Typography className={classes.pageTitle}>\n                Reset password\n              </Typography>\n              <Typography className={classes.ml20}>\n                Please, input your phone number\n              </Typography>\n              <NumberFormat\n                onChange={this.inputFieldChange}\n                value={this.state.num}\n                name=\"num\"\n                format={formatWithPattern}\n                customInput={PUCustomInput}\n              />\n              {this.state.phone_number_error && (\n                <Typography color=\"error\">\n                  {this.state.phone_number_error}\n                </Typography>\n              )}\n              <br />\n              <br />\n\n              {this.state.counter===0 ? <PUPrimaryButton\n                onClick={this.sendRestoreSmsCode}\n                className={`${classes.btnSend} ${classes.btn}`}\n              >\n                Send confirmation code\n              </PUPrimaryButton> : 'You can resend new code via '+this.state.counter}\n              <br />\n              <br />\n              <br />\n              <br />\n              <Typography className={`${classes.ml20}`}>\n                Input confirmation code from SMS\n              </Typography>\n              <NumberFormat\n                onChange={this.inputFieldChange}\n                name=\"confirmCode\"\n                value={this.state.confirmCode}\n                customInput={PUCustomInput}\n              />\n              {this.state.restore_password_code_error && (\n                <Typography color=\"error\">\n                  {this.state.restore_password_code_error}\n                </Typography>\n              )}\n              <br />\n              <br />\n              <Box display=\"flex\" justifyContent=\"space-between\">\n                <PUPrimaryButton\n                  component={Link}\n                  to=\"/login\"\n                  className={classes.btn}\n                >\n                  Cancel\n                </PUPrimaryButton>\n                <PUPrimaryButton\n                  onClick={this.restoreSmsCodeCheck}\n                  className={classes.btn}\n                >\n                  Reset password\n                </PUPrimaryButton>\n              </Box>\n            </>\n          )}\n\n          {/* <PUPrimaryButton onClick={this.saveNewPass} className={classes.btn}>Save PAss</PUPrimaryButton> */}\n        </div>\n      </PageLayout>\n    );\n  }\n}\n\nexport default withStyles(styles)(Radium(RestorePassword));\n"]},"metadata":{},"sourceType":"module"}