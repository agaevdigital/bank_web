{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _objectSpread from\"C:\\\\Users\\\\Dno\\\\Desktop\\\\pu-web\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import axios from\"axios\";import{api_endpoint}from\"../settings\";var axiosWithToken=axios.create({// baseURL: \"http://\" + window.location.hostname + \":\" + api_port,\nbaseURL:api_endpoint,timeout:1000});axiosWithToken.interceptors.request.use(function(config){if(config.method===\"get\"){config.params=_objectSpread({token:sessionStorage.getItem(\"token\"),key:sessionStorage.getItem(\"key\"),user_id:sessionStorage.getItem(\"user_id\")},config.params);}if(config.method===\"post\"){config.data=_objectSpread({token:sessionStorage.getItem(\"token\"),key:sessionStorage.getItem(\"key\"),user_id:sessionStorage.getItem(\"user_id\")},config.data);}return config;});axiosWithToken.interceptors.response.use(function(response){if(response.data&&response.data.response&&response.data.status===\"OK\"){sessionStorage.setItem(\"key\",response.data.response.key);sessionStorage.setItem(\"token\",response.data.response.token);}else if(response.data.status===\"FAIL\"){response.data.key&&sessionStorage.setItem(\"key\",response.data.key);response.data.token&&sessionStorage.setItem(\"token\",response.data.token);}if(response.data&&+response.data.code===17){window.location.replace(window.location.origin+'/login');}return response;});var Queue=/*#__PURE__*/function(){function Queue(){_classCallCheck(this,Queue);}_createClass(Queue,null,[{key:\"enqueue\",value:function enqueue(promise){var _this=this;return new Promise(function(resolve,reject){_this.queue.push({promise:promise,resolve:resolve,reject:reject});_this.dequeue();});}},{key:\"dequeue\",value:function dequeue(){var _this2=this;if(this.workingOnPromise){return false;}if(this.stop){this.queue=[];this.stop=false;return;}var item=this.queue.shift();if(!item){return false;}try{this.workingOnPromise=true;item.promise().then(function(value){_this2.workingOnPromise=false;item.resolve(value);_this2.dequeue();}).catch(function(err){_this2.workingOnPromise=false;item.reject(err);_this2.dequeue();});}catch(err){this.workingOnPromise=false;item.reject(err);this.dequeue();}return true;}},{key:\"get\",value:function get(){var _arguments=arguments;return this.enqueue(function(){return axiosWithToken.get.apply(axiosWithToken,_toConsumableArray(_arguments));});}},{key:\"post\",value:function post(){var _arguments2=arguments;return this.enqueue(function(){return axiosWithToken.post.apply(axiosWithToken,_toConsumableArray(_arguments2));});}}]);return Queue;}();Queue.queue=[];Queue.pendingPromise=false;Queue.stop=false;export default Queue;","map":{"version":3,"sources":["C:/Users/Dno/Desktop/pu-web/src/utils/axiosWithToken.js"],"names":["axios","api_endpoint","axiosWithToken","create","baseURL","timeout","interceptors","request","use","config","method","params","token","sessionStorage","getItem","key","user_id","data","response","status","setItem","code","window","location","replace","origin","Queue","promise","Promise","resolve","reject","queue","push","dequeue","workingOnPromise","stop","item","shift","then","value","catch","err","enqueue","get","arguments","post","pendingPromise"],"mappings":"ydAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,YAAT,KAA6B,aAA7B,CAGA,GAAMC,CAAAA,cAAc,CAAGF,KAAK,CAACG,MAAN,CAAa,CAClC;AACAC,OAAO,CAAEH,YAFyB,CAGlCI,OAAO,CAAE,IAHyB,CAAb,CAAvB,CAMAH,cAAc,CAACI,YAAf,CAA4BC,OAA5B,CAAoCC,GAApC,CAAyC,SAACC,MAAD,CAAY,CACnD,GAAIA,MAAM,CAACC,MAAP,GAAkB,KAAtB,CAA6B,CAC3BD,MAAM,CAACE,MAAP,gBACEC,KAAK,CAAEC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CADT,CAEEC,GAAG,CAAEF,cAAc,CAACC,OAAf,CAAuB,KAAvB,CAFP,CAGEE,OAAO,CAAEH,cAAc,CAACC,OAAf,CAAuB,SAAvB,CAHX,EAIKL,MAAM,CAACE,MAJZ,EAMD,CACD,GAAIF,MAAM,CAACC,MAAP,GAAkB,MAAtB,CAA8B,CAC5BD,MAAM,CAACQ,IAAP,gBACEL,KAAK,CAAEC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CADT,CAEEC,GAAG,CAAEF,cAAc,CAACC,OAAf,CAAuB,KAAvB,CAFP,CAGEE,OAAO,CAAEH,cAAc,CAACC,OAAf,CAAuB,SAAvB,CAHX,EAIKL,MAAM,CAACQ,IAJZ,EAMD,CAED,MAAQR,CAAAA,MAAR,CACD,CAnBD,EAqBAP,cAAc,CAACI,YAAf,CAA4BY,QAA5B,CAAqCV,GAArC,CAAyC,SAACU,QAAD,CAAc,CAErD,GACEA,QAAQ,CAACD,IAAT,EACAC,QAAQ,CAACD,IAAT,CAAcC,QADd,EAEAA,QAAQ,CAACD,IAAT,CAAcE,MAAd,GAAyB,IAH3B,CAIE,CACAN,cAAc,CAACO,OAAf,CAAuB,KAAvB,CAA8BF,QAAQ,CAACD,IAAT,CAAcC,QAAd,CAAuBH,GAArD,EACAF,cAAc,CAACO,OAAf,CAAuB,OAAvB,CAAgCF,QAAQ,CAACD,IAAT,CAAcC,QAAd,CAAuBN,KAAvD,EACD,CAPD,IAOO,IAAIM,QAAQ,CAACD,IAAT,CAAcE,MAAd,GAAyB,MAA7B,CAAqC,CAC1CD,QAAQ,CAACD,IAAT,CAAcF,GAAd,EAAqBF,cAAc,CAACO,OAAf,CAAuB,KAAvB,CAA8BF,QAAQ,CAACD,IAAT,CAAcF,GAA5C,CAArB,CACAG,QAAQ,CAACD,IAAT,CAAcL,KAAd,EAAuBC,cAAc,CAACO,OAAf,CAAuB,OAAvB,CAAgCF,QAAQ,CAACD,IAAT,CAAcL,KAA9C,CAAvB,CACD,CAED,GAAGM,QAAQ,CAACD,IAAT,EAAiB,CAACC,QAAQ,CAACD,IAAT,CAAcI,IAAf,GAAwB,EAA5C,CAAgD,CAC9CC,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwBF,MAAM,CAACC,QAAP,CAAgBE,MAAhB,CAAuB,QAA/C,EACD,CAED,MAAOP,CAAAA,QAAP,CACD,CAnBD,E,GAuBMQ,CAAAA,K,sIACWC,O,CAAS,gBACpB,MAAO,IAAIC,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACpC,KAAI,CAACC,KAAL,CAAWC,IAAX,CAAgB,CACZL,OAAO,CAAPA,OADY,CAEZE,OAAO,CAAPA,OAFY,CAGZC,MAAM,CAANA,MAHY,CAAhB,EAKA,KAAI,CAACG,OAAL,GACH,CAPM,CAAP,CAQH,C,yCAEgB,iBACb,GAAI,KAAKC,gBAAT,CAA2B,CACvB,MAAO,MAAP,CACH,CACD,GAAI,KAAKC,IAAT,CAAe,CACX,KAAKJ,KAAL,CAAa,EAAb,CACA,KAAKI,IAAL,CAAY,KAAZ,CACA,OACH,CACD,GAAMC,CAAAA,IAAI,CAAG,KAAKL,KAAL,CAAWM,KAAX,EAAb,CACA,GAAI,CAACD,IAAL,CAAW,CACP,MAAO,MAAP,CACH,CACD,GAAI,CACA,KAAKF,gBAAL,CAAwB,IAAxB,CACAE,IAAI,CAACT,OAAL,GACKW,IADL,CACU,SAAAC,KAAK,CAAI,CACX,MAAI,CAACL,gBAAL,CAAwB,KAAxB,CACAE,IAAI,CAACP,OAAL,CAAaU,KAAb,EACA,MAAI,CAACN,OAAL,GACH,CALL,EAMKO,KANL,CAMW,SAAAC,GAAG,CAAI,CACV,MAAI,CAACP,gBAAL,CAAwB,KAAxB,CACAE,IAAI,CAACN,MAAL,CAAYW,GAAZ,EACA,MAAI,CAACR,OAAL,GACH,CAVL,EAWH,CAAC,MAAOQ,GAAP,CAAY,CACV,KAAKP,gBAAL,CAAwB,KAAxB,CACAE,IAAI,CAACN,MAAL,CAAYW,GAAZ,EACA,KAAKR,OAAL,GACH,CACD,MAAO,KAAP,CACH,C,iCAEY,0BACX,MAAO,MAAKS,OAAL,CAAa,iBAAMxC,CAAAA,cAAc,CAACyC,GAAf,OAAAzC,cAAc,oBAAQ0C,UAAR,EAApB,EAAb,CAAP,CACD,C,mCAEa,2BACZ,MAAO,MAAKF,OAAL,CAAa,iBAAMxC,CAAAA,cAAc,CAAC2C,IAAf,OAAA3C,cAAc,oBAAS0C,WAAT,EAApB,EAAb,CAAP,CACD,C,qBAIHlB,KAAK,CAACK,KAAN,CAAc,EAAd,CACAL,KAAK,CAACoB,cAAN,CAAuB,KAAvB,CACApB,KAAK,CAACS,IAAN,CAAa,KAAb,CAGA,cAAeT,CAAAA,KAAf","sourcesContent":["import axios from \"axios\";\r\nimport { api_endpoint } from \"../settings\";\r\n\r\n\r\nconst axiosWithToken = axios.create({\r\n  // baseURL: \"http://\" + window.location.hostname + \":\" + api_port,\r\n  baseURL: api_endpoint,\r\n  timeout: 1000,\r\n});\r\n\r\naxiosWithToken.interceptors.request.use( (config) => {\r\n  if (config.method === \"get\") {\r\n    config.params = {\r\n      token: sessionStorage.getItem(\"token\"),\r\n      key: sessionStorage.getItem(\"key\"),\r\n      user_id: sessionStorage.getItem(\"user_id\"),\r\n      ...config.params,\r\n    };\r\n  }\r\n  if (config.method === \"post\") {\r\n    config.data = {\r\n      token: sessionStorage.getItem(\"token\"),\r\n      key: sessionStorage.getItem(\"key\"),\r\n      user_id: sessionStorage.getItem(\"user_id\"),\r\n      ...config.data,\r\n    };\r\n  }\r\n\r\n  return  config;\r\n});\r\n\r\naxiosWithToken.interceptors.response.use((response) => {\r\n\r\n  if (\r\n    response.data &&\r\n    response.data.response &&\r\n    response.data.status === \"OK\"\r\n  ) {\r\n    sessionStorage.setItem(\"key\", response.data.response.key);\r\n    sessionStorage.setItem(\"token\", response.data.response.token);\r\n  } else if (response.data.status === \"FAIL\") {\r\n    response.data.key && sessionStorage.setItem(\"key\", response.data.key);\r\n    response.data.token && sessionStorage.setItem(\"token\", response.data.token);\r\n  }\r\n\r\n  if(response.data && +response.data.code === 17) {\r\n    window.location.replace(window.location.origin+'/login');\r\n  }\r\n\r\n  return response;\r\n});\r\n\r\n\r\n\r\nclass Queue {\r\n  static enqueue(promise) {\r\n      return new Promise((resolve, reject) => {\r\n          this.queue.push({\r\n              promise,\r\n              resolve,\r\n              reject\r\n          });\r\n          this.dequeue();\r\n      });\r\n  }\r\n\r\n  static dequeue() {\r\n      if (this.workingOnPromise) {\r\n          return false;\r\n      }\r\n      if (this.stop) {\r\n          this.queue = [];\r\n          this.stop = false;\r\n          return;\r\n      }\r\n      const item = this.queue.shift();\r\n      if (!item) {\r\n          return false;\r\n      }\r\n      try {\r\n          this.workingOnPromise = true;\r\n          item.promise()\r\n              .then(value => {\r\n                  this.workingOnPromise = false;\r\n                  item.resolve(value);\r\n                  this.dequeue();\r\n              })\r\n              .catch(err => {\r\n                  this.workingOnPromise = false;\r\n                  item.reject(err);\r\n                  this.dequeue();\r\n              });\r\n      } catch (err) {\r\n          this.workingOnPromise = false;\r\n          item.reject(err);\r\n          this.dequeue();\r\n      }\r\n      return true;\r\n  }\r\n\r\n  static get() {\r\n    return this.enqueue(() => axiosWithToken.get(...arguments));\r\n  }\r\n\r\n  static post() {\r\n    return this.enqueue(() => axiosWithToken.post(...arguments));\r\n  }\r\n\r\n}\r\n\r\nQueue.queue = [];\r\nQueue.pendingPromise = false;\r\nQueue.stop = false;\r\n\r\n\r\nexport default Queue;\r\n\r\n"]},"metadata":{},"sourceType":"module"}